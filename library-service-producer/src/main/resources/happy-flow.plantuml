@startuml
!theme toy
title Payment Processing - Happy Flow
autonumber
actor Client

Client -> ServiceA: POST /payment
activate ServiceA

ServiceA -> DB: Insert payment_transaction status \n<b>PENDING</b>
DB --> ServiceA: OK

ServiceA -> Kafka: Produce topic.payment.request
Kafka --> ServiceA: OK

ServiceA -> ServiceC: POST /risk-score
activate ServiceC
ServiceC --> ServiceA: OK
deactivate ServiceC

ServiceA -> Kafka: Produce topic.payment.validated
Kafka --> ServiceA: OK

ServiceA -> DB: Commit transaction
ServiceA -> Kafka: Commit transaction
deactivate ServiceA

Kafka -> ServiceB: Consume topic.payment.request
activate ServiceB
ServiceB -> DB: Update payment_transaction status \n<b>RECEIVED</b>
DB --> ServiceB: OK

Kafka -> ServiceB: Consume topic.payment.validated
ServiceB -> DB: Update payment_transaction status \n<b>COMPLETED</b>
DB --> ServiceB: OK
deactivate ServiceB

@enduml
