@startuml
!theme toy
title Payment Processing - Failure on producer side during REST call
autonumber
actor Client

Client -> ServiceA: POST /payment
activate ServiceA

ServiceA -> DB: Insert PENDING into payment_transaction
DB --> ServiceA: OK

ServiceA -> Kafka: Produce payment-request topic
Kafka --> ServiceA: OK

ServiceA -> ServiceC: GET /risk-score
activate ServiceC
ServiceC --> ServiceA: timeout or error
deactivate ServiceC

ServiceA -> DB: Rollback transaction
ServiceA -> Kafka: Rollback transaction
deactivate ServiceA

Kafka -> ServiceB: No messages delivered
ServiceB -> DB: No update

@enduml
